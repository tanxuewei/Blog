# Chrome 浏览器垃圾回收机制与内存泄漏分析

## 理解 js 中的 堆（heap）和栈 (stack)

各种语言在处理堆栈的原理上都大同小异。堆是动态分配内存，内存大小不一，也不会自动释放。栈是自动分配相对固定大小的内存空间，并由系统自动释放。

javascript的基本类型就5种: Undefined、Null、Boolean、Number和String，它们都是直接按值存储在栈中的，每种类型的数据占用的内存空间的大小是确定的，并由系统自动分配和自动释放。这样带来的好处就是，内存可以及时得到回收，相对于堆来说，更加容易管理内存空间。

javascript中其他类型的数据被称为引用类型的数据 : 如对象(Object)、数组(Array)、函数(Function) …，它们是通过拷贝和new出来的，这样的数据存储于堆中。其实，说存储于堆中，也不太准确，因为，引用类型的数据的地址指针是存储于栈中的，当我们想要访问引用类型的值的时候，需要先从栈中获得对象的地址指针，然后，在通过地址指针找到堆中的所需要的数据。

## 垃圾回收机制

通常情况下，垃圾数据回收分为**手动回收**和**自动回收**两种策略。

> 手动回收策略，何时分配内存、何时销毁内存都是由代码控制的。
> 自动回收策略，产生的垃圾数据是由垃圾回收器来释放的，并不需要手动通过代码来释放。

1、 JavaScript 中调用栈中的数据回收

JavaScript 引擎会通过向下移动 ESP (记录当前执行状态的指针)来销毁该函数保存在栈中的执行上下文。

2、 JavaScript 堆中的数据回收

在 V8 中会把堆分为 新生代 和 老生代 两个区域，新生代中存放的是生存时间短的对象，老生代中存放的生存时间久的对象。

新生区通常只支持 1～8M 的容量，而老生区支持的容量就大很多了。对于这两块区域，V8 分别使用两个不同的垃圾回收器，以便更高效地实施垃圾回收。

* 副垃圾回收器，主要负责新生代的垃圾回收。
* 主垃圾回收器，主要负责老生代的垃圾回收。



V8 引擎？
