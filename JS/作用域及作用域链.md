# 作用域及作用域链

## 作用域

作用域是指程序源代码中定义变量的区域。
作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。
JavaScript 采用词法作用域（lexical scoping）, 也就是静态作用域。

### 静态作用域和动态作用域

静态作用域：**函数的作用域在函数定义的时候就决定了**
动态作用域：函数的作用域是在函数调用的时候才决定的

## 作用域链

当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从父级(词法层面上的父级)执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。这样由多个执行上下文的变量对象构成的链表就叫做作用域链。

作用域链，是由当前环境与上层环境的一系列变量对象组成，它保证了当前执行环境对符合访问权限的变量和函数的有序访问。

## 函数创建

这是因为函数有一个内部属性 [[scope]]，当函数创建的时候，就会保存所有父变量对象到其中，你可以理解 [[scope]] 就是所有父变量对象的层级链，但是注意：[[scope]] 并不代表完整的作用域链！

## 函数激活

当函数激活后，进入函数上下文，创建VO/AO后，就会将活动对象添加到作用域链的顶端。

这时候执行上下文的作用域链，我们命名为 Scope：

```js
Scope = [AO].concat([[Scope]]);
```

## 过程

```js
var scope = "global scope";
function checkscope(){
  var scope2 = 'local scope';
  return scope2;
}
checkscope();
```

**checkscope函数创建的时候，保存的是根据词法所生成的作用域链。checkscope执行的时候，会复制这个作用域链，作为自己作用域链的初始化，然后根据环境生成变量对象，然后将这个变量对象，添加到这个复制的作用域链顶端，这才完成了构建自己的作用域链。至于为什么会有两个作用域链，是因为函数在创建的时候并不能确定最终的作用域的样子。为什么会采用复制的形式而不是直接修改呢？应该是因为函数会被调用很多次吧。**
